{"version":3,"file":"index.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport axios from 'axios';\n\nexport const API_KEY = '47332202-20d723453e83dbf57917d8670';\n\nexport async function fetchImages(query, per_page = 20, page) {\n  const BASE_URL = 'https://pixabay.com/api/';\n\n  try {\n    const response = await axios.get(`${BASE_URL}`, {\n      params: {\n        key: API_KEY,\n        q: query,\n        image_type: 'photo',\n        orientation: 'horizontal',\n        safesearch: true,\n        page,\n        per_page,\n      },\n    });\n    return response.data;\n  } catch (error) {\n    //console.log(error.message);\n    iziToast.error({\n      title: 'Error',\n      message: `Error: ${error.message}`,\n    });\n    //throw error;\n  }\n}\n","import { cardContainer } from '../main.js';\nimport { loadMoreBtn } from '../main.js';\n\nexport function createMarkup(arr) {\n  return arr\n    .map(\n      ({\n        webformatURL,\n        largeImageURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads,\n      }) =>\n        `\n        <li class=\"img-card\">\n          <div class=\"img-img\">\n            <a class=\"gallery-link\" href=\"${largeImageURL}\">\n              <img class=\"gallery-image\" src=\"${webformatURL}\" alt=\"${tags}\" />\n            </a>\n          </div>\n          <div class=\"img-info\">\n            <ul class=\"img-info-list\">\n              <li><h3>Likes</h3><p>${likes}</p></li>\n              <li><h3>Views</h3><p>${views}</p></li>\n              <li><h3>Comments</h3><p>${comments}</p></li>\n              <li><h3>Downloads</h3><p>${downloads}</p></li>\n            </ul>\n          </div>\n        </li>\n      `\n    )\n    .join('');\n}\n\n/**\n * @param {HTMLElement} cardContainer - The container element to render into.\n * @param {string} markup - The HTML markup to render.\n */\nexport function renderMarkup(cardContainer, markup) {\n  cardContainer.insertAdjacentHTML('beforeend', markup);\n  loadMoreBtn.classList.replace('hidden', 'load-more-button');\n}\n\n//Clears the image cards container:\n// @param {HTMLElement} cardContainer - The container element to clear.\nexport function clearCardContainer(cardContainer) {\n  cardContainer.innerHTML = '';\n}\n","import axios from 'axios';\n\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\niziToast.settings({\n  position: 'topRight',\n});\n\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nimport { fetchImages } from './js/pixabay-api.js';\nimport {\n  createMarkup,\n  renderMarkup,\n  clearCardContainer,\n} from './js/render-functions.js';\n\nconst form = document.querySelector('.js-search-form');\nconst qInput = document.querySelector('#query');\nconst loader = document.getElementById('loader');\nconst cardContainer = document.querySelector('.image-cards');\nexport { cardContainer };\nconst loadMoreBtn = document.querySelector('#load-more');\nexport { loadMoreBtn };\n\nlet query;\n\nlet page = 1;\nlet per_page = 15;\nlet scrollOffset = 300; // Default value for scrolling down\n\n// loadMoreBtn.addEventListener('click', onClickLoadMore);\n// console.log('Adding click listener to loadMoreBtn');\nif (!loadMoreBtn.dataset.listenerAttached) {\n  console.log('Adding click listener to loadMoreBtn');\n  loadMoreBtn.addEventListener('click', onClickLoadMore);\n  loadMoreBtn.dataset.listenerAttached = 'true'; // Mark listener as attached\n}\n\nconst lightbox = new SimpleLightbox('.image-cards a');\n\nif (!window.__formSubmitListenerAttached) {\n  form.addEventListener('submit', event => {\n    //console.log('Event listener attached');\n    event.preventDefault();\n    query = qInput.value.trim();\n    page = 1; //Reset page to 1 for a new search\n    if (!query) {\n      iziToast.warning({\n        title: 'Error',\n        message: 'Please enter a searched word',\n      });\n      return;\n    }\n\n    //console.log('Submitted query:', query);\n\n    // Show loader\n    console.log('Before enabling loader:', loader.classList);\n    loader.classList.remove('disabled'); // Enable loader\n    console.log('After enabling loader:', loader.classList);\n\n    fetchImages(query, per_page, page)\n      .then(data => {\n        if (data.hits.length === 0) {\n          iziToast.warning({\n            title: 'No Results',\n            message: 'No images found for your query.',\n          });\n          clearCardContainer(cardContainer); // Clear the cardContainer if no results\n          return;\n        }\n\n        clearCardContainer(cardContainer); // Clear the cardContainer\n        const markup = createMarkup(data.hits);\n        renderMarkup(cardContainer, markup); // Render markup\n\n        let totalPages = Math.ceil(data.totalHits / per_page);\n        //Check if all imgs are on 1 page || 0 imgs, so there is no more images to display:\n        if (totalPages <= page) {\n          loadMoreBtn.classList.add('hidden'); // Hide the button\n          loader.classList.add('disabled'); // Hide loader\n\n          iziToast.warning({\n            title: 'No more pages',\n            message:\n              \"We're sorry, but you've reached the end of search results.\",\n          });\n          return;\n        }\n\n        loadMoreBtn.classList.replace('hidden', 'load-more-button'); //LoadMore is visible\n        //console.log('Updated loadMoreBtn classList:', [...loadMoreBtn.classList]);\n\n        // Element height - bounding rectangle\n        let elem = document.querySelector('.img-card'); // Card element\n        if (elem) {\n          let rect = elem.getBoundingClientRect();\n          //console.log('Bounding Rect:', rect);\n          scrollOffset = rect.height * 2; // Update the scrol-down offset\n          //console.log('Scroll Offset:', scrollOffset);\n        }\n\n        lightbox.refresh(); // Refresh lightbox for new elements\n      })\n      .catch(error => {\n        console.error('Error fetching images:', error);\n        iziToast.error({\n          title: 'Error',\n          message: `Failed to fetch images: ${error.message}`,\n        });\n      })\n      .finally(() => {\n        // Hide loader\n        loader.classList.add('disabled');\n        console.log('loader disabled:', loader.classList);\n      });\n  });\n\n  window.__formSubmitListenerAttached = true;\n}\n\nasync function onClickLoadMore() {\n  page += 1;\n  //console.log('page:', page);\n  try {\n    const data = await fetchImages(query, per_page, page);\n\n    console.log('Before enabling loader:', loader.classList);\n    loader.classList.remove('disabled'); // Remove the disabled class\n    //loader.style.display = 'block'; // Explicitly make it visible\n\n    await new Promise(resolve => setTimeout(resolve, 1500)); // Delay for visibility\n    console.log(`Loaded ${data.hits.length} images`);\n    console.log('After enabling loader:', loader.classList);\n\n    //loader.className = loader.className.replace('disabled', '').trim();\n    //console.log('Loader enabled', loader.classList);\n\n    // console.log('Before enabling loader:', loader.classList);\n    // loader.classList.remove('disabled'); // Enable loader\n    // console.log('After enabling loader:', loader.classList);\n\n    // console.log('Before removing disabled:', loader.classList);\n    // loader.classList.remove('disabled');\n    // console.log('After removing disabled:', loader.classList);\n\n    // Append the new items to the gallery\n    const markup = createMarkup(data.hits);\n    renderMarkup(cardContainer, markup);\n    loader.classList.add('disabled'); // Hide loader\n    // loader.style.display = '';\n    console.log('After disabling loader:', loader.classList);\n    //Scroll\n    window.scrollBy({\n      top: scrollOffset, // Use the updated value\n      left: 0,\n      behavior: 'smooth',\n    });\n\n    let totalPages = Math.ceil(data.totalHits / per_page);\n    //console.log(`totalPages = ${totalPages}`);\n    if (page >= totalPages) {\n      // console.log(\"We're sorry, but you've reached the end of search results.\");\n      loadMoreBtn.classList.add('hidden'); // Hide the button\n      loader.classList.add('disabled'); // Hide loader\n      iziToast.warning({\n        title: 'No more pages',\n        message: \"We're sorry, but you've reached the end of search results.\",\n      });\n      return;\n    }\n    // Refresh the lightbox to include new images\n    lightbox.refresh();\n  } catch (error) {\n    iziToast.error({\n      title: 'Error',\n      message: `Failed to load more images: ${error.message}`,\n    });\n  } finally {\n    // Ensure loader is hidden on completion\n    loader.classList.add('disabled');\n    console.log('Final loader state:', loader.classList);\n  }\n}\n\nif (!window.__loadMoreClickListenerAttached) {\n  loadMoreBtn.addEventListener('click', onClickLoadMore);\n  window.__loadMoreClickListenerAttached = true;\n}\n"],"names":["API_KEY","fetchImages","query","per_page","page","BASE_URL","axios","error","iziToast","createMarkup","arr","webformatURL","largeImageURL","tags","likes","views","comments","downloads","renderMarkup","cardContainer","markup","loadMoreBtn","clearCardContainer","form","qInput","loader","scrollOffset","onClickLoadMore","lightbox","SimpleLightbox","event","data","elem","resolve","totalPages"],"mappings":"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"}