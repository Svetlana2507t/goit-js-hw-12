{"version":3,"file":"index.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport axios from 'axios';\n\nexport const API_KEY = '47332202-20d723453e83dbf57917d8670';\n\nexport async function fetchImages(query, per_page = 20, page) {\n  const BASE_URL = 'https://pixabay.com/api/';\n\n  try {\n    const response = await axios.get(`${BASE_URL}`, {\n      params: {\n        key: API_KEY,\n        q: query,\n        image_type: 'photo',\n        orientation: 'horizontal',\n        safesearch: true,\n        page,\n        per_page,\n      },\n    });\n    return response.data;\n  } catch (error) {\n    console.log(error.message);\n    iziToast.error({\n      title: 'Error',\n      message: `Error: ${error.message}`,\n    });\n    throw error;\n  }\n}\n","import { cardContainer } from '../main.js';\nimport { loadMoreBtn } from '../main.js';\n\nexport function createMarkup(arr) {\n  return arr\n    .map(\n      ({\n        webformatURL,\n        largeImageURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads,\n      }) =>\n        `\n        <li class=\"img-card\">\n          <div class=\"img-img\">\n            <a class=\"gallery-link\" href=\"${largeImageURL}\">\n              <img class=\"gallery-image\" src=\"${webformatURL}\" alt=\"${tags}\" />\n            </a>\n          </div>\n          <div class=\"img-info\">\n            <ul class=\"img-info-list\">\n              <li><h3>Likes</h3><p>${likes}</p></li>\n              <li><h3>Views</h3><p>${views}</p></li>\n              <li><h3>Comments</h3><p>${comments}</p></li>\n              <li><h3>Downloads</h3><p>${downloads}</p></li>\n            </ul>\n          </div>\n        </li>\n      `\n    )\n    .join('');\n}\n\n/**\n * @param {HTMLElement} cardContainer - The container element to render into.\n * @param {string} markup - The HTML markup to render.\n */\nexport function renderMarkup(cardContainer, markup) {\n  cardContainer.insertAdjacentHTML('beforeend', markup);\n  loadMoreBtn.classList.replace('hidden', 'load-more-button');\n}\n\n//Clears the image cards container:\n// @param {HTMLElement} cardContainer - The container element to clear.\nexport function clearCardContainer(cardContainer) {\n  cardContainer.innerHTML = '';\n}\n","import axios from 'axios';\n\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\niziToast.settings({\n  position: 'topRight',\n});\n\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nimport { fetchImages } from './js/pixabay-api.js';\nimport {\n  createMarkup,\n  renderMarkup,\n  clearCardContainer,\n} from './js/render-functions.js';\n\nconst form = document.querySelector('.js-search-form');\nconst qInput = document.querySelector('#query');\nconst loader = document.getElementById('loader');\nconst cardContainer = document.querySelector('.image-cards');\nexport { cardContainer };\nconst loadMoreBtn = document.querySelector('#load-more');\nexport { loadMoreBtn };\n\nlet query;\n\nlet page = 1;\nlet per_page = 15;\nlet scrollOffset = 300; // Default value for scrolling down\n\nloadMoreBtn.addEventListener('click', onClickLoadMore);\n\nconst lightbox = new SimpleLightbox('.image-cards a');\n\nform.addEventListener('submit', event => {\n  event.preventDefault();\n  query = qInput.value.trim();\n  page = 1; //Reset page to 1 for a new search\n  if (!query) {\n    iziToast.warning({\n      title: 'Error',\n      message: 'Please enter a searched word',\n    });\n    return;\n  }\n\n  //console.log('Submitted query:', query);\n\n  // Show loader\n  loader.classList.remove('disabled');\n  //console.log('Loader active:', loader.classList);\n\n  fetchImages(query, per_page, page)\n    .then(data => {\n      if (data.hits.length === 0) {\n        iziToast.warning({\n          title: 'No Results',\n          message: 'No images found for your query.',\n        });\n        clearCardContainer(cardContainer); // Clear the cardContainer if no results\n        return;\n      }\n\n      clearCardContainer(cardContainer); // Clear the cardContainer\n      const markup = createMarkup(data.hits);\n      renderMarkup(cardContainer, markup); // Render markup\n\n      let totalPages = Math.ceil(data.totalHits / per_page);\n      //Check if all imgs are on 1 page || 0 imgs, so there is no more images to display:\n      if (totalPages <= page) {\n        loadMoreBtn.classList.add('hidden'); // Hide the button\n        iziToast.warning({\n          title: 'No more pages',\n          message: \"We're sorry, but you've reached the end of search results.\",\n        });\n        return;\n      }\n\n      loadMoreBtn.classList.replace('hidden', 'load-more-button'); //LoadMore is visible\n      //console.log('Updated loadMoreBtn classList:', [...loadMoreBtn.classList]);\n\n      // Element height - bounding rectangle\n      let elem = document.querySelector('.img-card'); // Card element\n      if (elem) {\n        let rect = elem.getBoundingClientRect();\n        //console.log('Bounding Rect:', rect);\n        scrollOffset = rect.height * 2; // Update the scrol-down offset\n        //console.log('Scroll Offset:', scrollOffset);\n      }\n      lightbox.refresh(); // Refresh lightbox for new elements\n    })\n    .catch(error => {\n      console.error('Error fetching images:', error);\n      iziToast.error({\n        title: 'Error',\n        message: `Failed to fetch images: ${error.message}`,\n      });\n    })\n    .finally(() => {\n      // Hide loader\n      loader.classList.add('disabled');\n    });\n});\n\nasync function onClickLoadMore() {\n  page += 1;\n  //console.log('page:', page);\n  try {\n    loader.classList.remove('disabled'); // Show loader\n\n    const data = await fetchImages(query, per_page, page);\n\n    let totalPages = Math.ceil(data.totalHits / per_page);\n    //console.log(`totalPages = ${totalPages}`);\n    if (page >= totalPages) {\n      console.log(\"We're sorry, but you've reached the end of search results.\");\n      loadMoreBtn.classList.add('hidden'); // Hide the button\n      iziToast.warning({\n        title: 'No more pages',\n        message: \"We're sorry, but you've reached the end of search results.\",\n      });\n      return;\n    }\n    // Append the new items to the gallery\n    const markup = createMarkup(data.hits);\n    renderMarkup(cardContainer, markup);\n    loader.classList.add('disabled'); // Hide loader\n    //Scroll\n    window.scrollBy({\n      top: scrollOffset, // Use the updated value\n      left: 0,\n      behavior: 'smooth',\n    });\n\n    // Refresh the lightbox to include new images\n    lightbox.refresh();\n  } catch {\n    console.error('Error in onClickLoadMore:', error.message);\n    iziToast.error({\n      title: 'Error',\n      message: `Failed to load more images: ${error.message}`,\n    });\n  }\n}\n"],"names":["API_KEY","fetchImages","query","per_page","page","BASE_URL","axios","error","iziToast","createMarkup","arr","webformatURL","largeImageURL","tags","likes","views","comments","downloads","renderMarkup","cardContainer","markup","loadMoreBtn","clearCardContainer","form","qInput","loader","scrollOffset","onClickLoadMore","lightbox","SimpleLightbox","event","data","elem","totalPages"],"mappings":"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"}